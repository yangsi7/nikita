"""Tests for Spec 058 vulnerability exchange detection in analyzer."""

from __future__ import annotations

from nikita.engine.scoring.analyzer import ANALYSIS_SYSTEM_PROMPT


class TestVulnerabilityExchangePrompt:
    """AC-6.1, AC-6.2, AC-6.4: Vulnerability detection in analyzer prompt."""

    def test_prompt_contains_vulnerability_section(self):
        assert "Vulnerability Exchange Detection" in ANALYSIS_SYSTEM_PROMPT

    def test_prompt_mentions_vulnerability_exchange_tag(self):
        assert "vulnerability_exchange" in ANALYSIS_SYSTEM_PROMPT

    def test_prompt_requires_mutual_sharing(self):
        assert "one-sided sharing" in ANALYSIS_SYSTEM_PROMPT.lower() or \
               "one-sided" in ANALYSIS_SYSTEM_PROMPT.lower()

    def test_prompt_mentions_both_conditions(self):
        # Nikita shares + player responds
        assert "Nikita shared" in ANALYSIS_SYSTEM_PROMPT or \
               "Nikita share" in ANALYSIS_SYSTEM_PROMPT
        assert "Player respond" in ANALYSIS_SYSTEM_PROMPT or \
               "player respond" in ANALYSIS_SYSTEM_PROMPT
